# Development Dockerfile for Vite React App (with pnpm)
# Single stage with hot reload support

FROM node:20-alpine

RUN apk add --no-cache libc6-compat

# Install pnpm
RUN npm install -g pnpm

WORKDIR /app

# Copy pnpm files
COPY package.json pnpm-lock.yaml pnpm-workspace.yaml ./
COPY apps/client/package.json ./apps/client/
COPY packages/shared/package.json ./packages/shared/
COPY packages/eslint-config/package.json ./packages/eslint-config/
COPY packages/typescript-config/package.json ./packages/typescript-config/
COPY packages/ui/package.json ./packages/ui/
COPY turbo.json ./

# Install all dependencies (including dev)
RUN pnpm install --frozen-lockfile

# Copy all source code
COPY . .

# Build shared packages only (client will run in dev mode)
RUN pnpm --filter "@repo/shared" build
RUN pnpm --filter "@repo/ui" build
RUN pnpm --filter "@repo/eslint-config" build
RUN pnpm --filter "@repo/typescript-config" build

WORKDIR /app

EXPOSE 5173

# Configure Vite to accept connections from any host (for Docker)
CMD ["pnpm", "--filter", "client", "dev", "--", "--host", "0.0.0.0"]